# BDC 系统功能明细清单

## 1. 基础架构
### 1.1 系统配置
- ✓ 环境变量配置（开发/生产）[src/config/database.ts: dotenv.config]
- ✓ 数据库连接基础配置 [src/config/database.ts: dbConfig]
  - ✓ 基本连接参数
  - ✓ 环境变量支持
  - ✓ 实体注册
  - ✓ 迁移和订阅者配置
- ✓ 数据库连接高级配置 [src/config/database.ts: dbConfig & initializeDatabase]
  - ✓ 连接池配置 [src/config/database.ts: dbConfig.extra]
    - ✓ 最大连接数
    - ✓ 最小连接数
    - ✓ 连接超时
    - ✓ 空闲超时
  - ✓ 重试策略 [src/config/database.ts: initializeDatabase]
    - ✓ 重试次数
    - ✓ 重试间隔
    - ✓ 重试条件
  - ✓ 超时设置 [src/config/database.ts: dbConfig.extra]
    - ✓ 查询超时
    - ✓ 连接超时
    - ✓ 事务超时
  - ✓ 日志配置 [src/config/logger.ts: Logger]
    - ✓ 查询日志
    - ✓ 错误日志
    - ✓ 慢查询日志
  - ✓ 迁移管理 [src/config/database.ts: dbConfig.migrations]
    - ✓ 迁移版本控制
    - ✓ 迁移回滚
    - ✓ 迁移状态检查
- ✓ GraphQL API 基础配置 [src/index.ts: ApolloServer]
  - ✓ Apollo Server 设置
  - ✓ 基础 Schema 定义
  - ✓ 基础 Resolvers
  - ✓ GraphQL Playground
- [ ] GraphQL API 高级配置（计划中）
  - [x] 错误处理中间件 [src/middlewares/errorHandler.ts: errorHandler]
    - [x] 统一错误处理
    - [x] 自定义错误类型 [src/errors/types.ts: AppError]
    - [x] 错误日志记录 [src/utils/logger.ts: Logger]
    - [x] 错误响应格式化
  - [ ] 请求验证
    - [ ] 输入数据深度验证
    - [ ] 业务规则验证
    - [ ] 权限验证
    - [ ] 数据完整性检查
  - [ ] 性能监控
    - [ ] 查询性能追踪
    - [ ] N+1 查询检测
    - [ ] 查询复杂度分析
    - [ ] 性能指标收集
  - [ ] 缓存配置
    - [ ] 查询缓存
    - [ ] 数据缓存
    - [ ] 缓存失效策略
    - [ ] 缓存监控
  - [ ] 自定义指令
    - [ ] 权限控制指令
    - [ ] 数据验证指令
    - [ ] 缓存控制指令
    - [ ] 日志记录指令
- ✓ 健康检查接口

### 1.2 动态数据结构设计 API（Schema 管理）
- ✓ Schema 设计 API
  - ✓ 创建数据结构定义
  - ✓ 更新数据结构定义
  - ✓ 删除数据结构定义
  - ✓ 查询数据结构定义
- ✓ Schema 存储
  - ✓ 数据结构定义持久化
  - ✓ 版本控制
  - ✓ 状态管理
- ✓ Schema 验证
  - ✓ JSON Schema 支持
  - ✓ 字段类型验证
  - ✓ 必填字段验证
  - ✓ 自定义验证规则
- [ ] 字段基本属性支持
  - [ ] 字段 ID（系统自动生成）
  - [ ] 字段名称（命名规范校验）
  - [ ] 字段描述（多行文本支持）
- [ ] 字段类型支持
  - [ ] 基础类型
    - [ ] UUID uuid
    - [ ] 自增长 auto-increment
    - [ ] 字符串 varchar
    - [ ] 文本 text 
    - [ ] 数字 number 
    - [ ] 布尔值 boolean
    - [ ] 日期 date（多种格式）
  - [ ] 高级类型
    - [ ] 枚举 enum（单选/多选）
    - [ ] 关联ID relation（单选/多选）
    - [ ] 媒体 media（文件/图片/视频）
    - [ ] API数据源 api
- [ ] 字段扩展属性
  - [ ] 主键属性
  - [ ] 长度属性
  - [ ] 日期格式
  - [ ] 枚举配置
  - [ ] 媒体配置
  - [ ] 关联配置
  - [ ] API 数据源配置

### 1.3 枚举管理
- [ ] 枚举定义
  - [ ] 枚举 ID（系统自动生成，确保全局唯一）
  - [ ] 枚举名称（命名规则：小写字母开头，只包含小写字母、数字和下划线）
  - [ ] 枚举描述（支持多行文本）
  - [ ] 枚举值列表（支持单选和多选模式）
  - [ ] 枚举分类（支持多级分类结构）
- [ ] 枚举值管理
  - [ ] 存储值（唯一标识）
  - [ ] 显示标签（用户友好的显示文本）
  - [ ] 描述信息（支持多行文本）
  - [ ] 排序号（控制显示顺序）
  - [ ] 状态标记（启用/禁用）
  - [ ] 父级关联（用于多级枚举）
- [ ] 枚举使用配置
  - [ ] 字段绑定（通过 enumId 关联）
  - [ ] 选择模式配置
    - [ ] 单选模式（存储单个值）
    - [ ] 多选模式（以数组形式存储）
  - [ ] 默认值设置
    - [ ] 单选默认值
    - [ ] 多选默认值数组
  - [ ] 值校验规则
    - [ ] 必选校验
    - [ ] 选项范围校验
    - [ ] 自定义校验规则
- [ ] 枚举数据维护
  - [ ] 批量导入导出
  - [ ] 版本控制
  - [ ] 使用情况统计
  - [ ] 废弃处理

### 1.4 媒体系统集成
- [ ] 媒体 ID 管理
  - [ ] ID 生成规则
  - [ ] 元数据管理
- [ ] 媒体处理能力
  - [ ] 图片处理（缩放/裁剪/水印）
  - [ ] 视频处理（转码/截图）
  - [ ] 文档处理（预览/转换）
- [ ] 媒体存储管理
  - [ ] 存储路径规划
  - [ ] 访问 URL 生成
  - [ ] 文件生命周期管理

### 1.5 关联数据管理
- [ ] 关联数据选择器
  - [ ] 字段显示配置
  - [ ] 搜索和筛选
  - [ ] 分页加载
  - [ ] 预览功能
- [ ] 数据完整性
  - [ ] 级联删除策略
  - [ ] 循环引用检查
  - [ ] 关联记录校验
  - [ ] 权限控制
- [ ] 关联数据展示
  - [ ] 列表页关键信息
  - [ ] 详情页完整信息
  - [ ] 快速跳转
  - [ ] 批量操作

### 1.3 业务数据 API（基于 Schema）
- ✓ 动态 GraphQL API
  - ✓ 自动生成类型定义
  - ✓ 自动生成查询接口
  - ✓ 自动生成变更接口
  - ✓ 自动生成过滤和排序
- ✓ 数据操作
  - ✓ 数据创建
  - ✓ 数据更新
  - ✓ 数据删除
  - ✓ 数据查询
- ✓ API 文档
  - ✓ GraphQL Playground
  - ✓ 自动生成的 API 文档
  - ✓ 查询和变更示例

## 2. 业务数据结构设计样例（基于动态数据结构）
### 2.1 生产计划数据结构
- [ ] 计划基础信息
  - [ ] 计划编号（自动生成）
  - [ ] 计划名称
  - [ ] 计划类型
  - [ ] 计划状态
  - [ ] 计划版本
- [ ] 计划内容
  - [ ] 产品信息
  - [ ] 计划数量
  - [ ] 开始时间
  - [ ] 结束时间
  - [ ] 优先级
- [ ] 计划执行
  - [ ] 实际进度
  - [ ] 完成数量
  - [ ] 执行状态
  - [ ] 异常记录

### 2.2 设备数据结构
- [ ] 设备基础信息
  - [ ] 设备编码
  - [ ] 设备名称
  - [ ] 设备类型
  - [ ] 技术参数
  - [ ] 制造商信息
- [ ] 设备状态
  - [ ] 运行状态
  - [ ] 维护状态
  - [ ] 故障状态
  - [ ] 使用记录

### 2.3 原材料数据结构
- [ ] 物料基础信息
  - [ ] 物料编码
  - [ ] 物料名称
  - [ ] 规格型号
  - [ ] 计量单位
  - [ ] 供应商信息
- [ ] 库存信息
  - [ ] 当前库存
  - [ ] 安全库存
  - [ ] 最大库存
  - [ ] 库存预警

## 测试样例：业务功能实现（基于设计的数据结构）
- 生产计划管理
  - [ ] 计划管理
    - [ ] 计划创建
    - [ ] 计划修改
    - [ ] 计划查询
    - [ ] 计划删除
  - [ ] 计划执行
    - [ ] 进度记录
    - [ ] 状态更新
    - [ ] 异常处理

- 设备管理
  - [ ] 设备管理
    - [ ] 设备登记
    - [ ] 设备查询
    - [ ] 状态更新
  - [ ] 设备维护
    - [ ] 维护记录
    - [ ] 故障记录
    - [ ] 维修记录

## 开发说明
1. API 架构
   - Schema 管理 API：用于设计和管理业务数据结构定义
     - 提供数据结构的 CRUD 操作
     - 支持版本控制和状态管理
     - 数据结构定义存储在数据库中
   - 业务数据 API：基于 Schema 自动生成的 GraphQL API
     - 根据数据结构定义自动生成类型
     - 提供数据的 CRUD 操作
     - 支持复杂的查询和过滤

2. 开发流程
   - 使用 Schema 管理 API 设计业务数据结构
   - 系统自动生成对应的 GraphQL API
   - 通过生成的 API 实现业务功能
   - 所有业务数据操作都通过 GraphQL API 进行

3. 开发状态
   - ✓ 已完成（基础架构和 API 框架）
   - [ ] 开发中（业务数据结构设计）
   - [ ] 待开发（业务功能实现）
   - [ ] 计划中（系统功能和报表） 