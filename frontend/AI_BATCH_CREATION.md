# AI 批量创建模型功能

## 概述

AI 创建模型功能现在支持批量创建多个相关的数据模型，当用户的需求涉及多个相关表时，AI 会自动生成多个模型。

## 功能特性

1. **智能识别**：AI 会根据用户需求自动判断是否需要生成多个模型
2. **批量创建**：支持一次创建多个相关的数据模型
3. **标签页展示**：多个模型使用 Tabs 标签页形式展示，便于查看和确认
4. **关联关系**：多个模型之间会自动建立关联关系
5. **错误隔离**：批量创建中，一个模型的创建失败不会影响其他模型

## 使用方式

### 单个模型创建

当用户描述的需求只涉及单个表时，AI 会生成单个模型：

```json
{
  "name": "商品信息表",
  "code": "ecommerce:product",
  "description": "存储商品的基本信息",
  "fields": [...],
  "keyIndexes": {...},
  "newEnums": [...]
}
```

### 多个模型创建

当用户描述的需求涉及多个相关表时，AI 会生成多个模型：

```json
{
  "schemas": [
    {
      "name": "用户信息表",
      "code": "system:user",
      "description": "存储用户的基本信息",
      "fields": [...],
      "keyIndexes": {...}
    },
    {
      "name": "角色信息表", 
      "code": "system:role",
      "description": "存储角色信息",
      "fields": [...],
      "keyIndexes": {...}
    },
    {
      "name": "用户角色关联表",
      "code": "system:user_role", 
      "description": "用户和角色的关联关系",
      "fields": [...],
      "keyIndexes": {...}
    }
  ],
  "newEnums": [...]
}
```

## 界面展示

### 第一步：输入需求

用户描述业务需求，AI 会分析是否需要多个模型：

```
请详细描述你想要创建的数据模型，AI 将根据你的描述自动生成完整的模型结构。

例如：
- 存储用户的基本信息，包含姓名、邮箱、手机号、性别、生日等字段
- 需要支持用户注册、登录、个人信息修改等功能
- 邮箱和手机号需要唯一性约束
- 需要记录创建时间和更新时间

或者：
- 电商系统：需要用户表、商品表、订单表、分类表等
- 用户管理系统：需要用户表、角色表、权限表等
- 内容管理系统：需要文章表、分类表、标签表、用户表等
```

### 第二步：确认模型

#### 单个模型确认

如果是单个模型，使用原有的确认界面：

- 显示模型信息
- 显示字段列表
- 显示新枚举信息
- 显示索引配置
- 提供修改和确认按钮

#### 多个模型确认

如果是多个模型，使用 Tabs 标签页展示：

- 每个模型一个标签页
- 标签页标题显示模型代码和名称
- 标签页内容显示该模型的详细信息
- 修改要求和操作按钮在标签页外部
- 确认按钮会创建所有模型

## 技术实现

### 1. 提示词生成器修改

修改了 `modelDesignPromptGenerator.ts` 中的提示词，支持多个模型的生成：

- 添加了多模型示例说明
- 提供了两种 JSON 格式的响应模板
- 指导 AI 根据业务需求判断是否需要多个模型

### 2. AICreateSchema 组件修改

修改了 `AICreateSchema/index.tsx` 组件：

- 添加了 `GeneratedSchemas` 接口
- 添加了 `generatedSchemas` 状态
- 修改了 AI 响应解析逻辑，支持多模型格式
- 添加了 `renderMultipleSchemasConfirmation` 方法
- 使用 Tabs 组件展示多个模型

### 3. SchemaManagement 页面修改

修改了 `SchemaManagement/index.tsx` 页面：

- 更新了 `handleAICreateSchema` 方法的参数类型
- 添加了对多模型格式的支持
- 使用批量创建 API 创建多个模型

### 4. 后端 API 支持

后端 `POST /api/schemas` 接口已经支持批量创建：

- 支持单个对象和对象数组两种格式
- 批量创建时提供详细的成功/失败信息
- 错误隔离，一个失败不影响其他

## 使用示例

### 电商系统示例

用户输入：
```
我需要一个电商系统，包含用户管理、商品管理、订单管理等功能
```

AI 可能生成：
- `system:user` - 用户信息表
- `system:role` - 角色信息表  
- `system:user_role` - 用户角色关联表
- `ecommerce:product` - 商品信息表
- `ecommerce:category` - 商品分类表
- `ecommerce:order` - 订单信息表
- `ecommerce:order_item` - 订单商品表

### 内容管理系统示例

用户输入：
```
我需要一个内容管理系统，包含文章管理、分类管理、标签管理、用户管理等功能
```

AI 可能生成：
- `cms:user` - 用户信息表
- `cms:article` - 文章信息表
- `cms:category` - 分类信息表
- `cms:tag` - 标签信息表
- `cms:article_tag` - 文章标签关联表

## 注意事项

1. **关联关系**：多个模型之间会自动建立关联关系，使用 `relation` 类型字段
2. **命名规范**：模型代码使用多级命名，如 `system:user`、`ecommerce:product`
3. **枚举共享**：多个模型可以共享枚举定义
4. **错误处理**：批量创建时，会显示每个模型的创建结果
5. **性能考虑**：建议一次创建不超过 10 个模型，避免请求过大

## 最佳实践

1. **需求描述**：详细描述业务需求，包括功能模块和实体关系
2. **模型数量**：根据业务复杂度合理控制模型数量
3. **关联设计**：确保模型之间有合理的关联关系
4. **命名规范**：使用有意义的多级命名，便于管理和理解
5. **测试验证**：创建后验证模型结构和关联关系是否正确 